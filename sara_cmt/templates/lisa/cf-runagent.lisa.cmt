# This file is automagicly generated by SARA CMT
#
#               SARA - Computing and Networking Services
# Date        : Wed, 18 Aug 2010
# Version     : {{ version }}
# Generated   : {% now "r" %}
#
# Description :
#
# SVN:
#       {{ svn_id }}
#       {{ svn_url }}
#
{% load cmts_extras %}
{% noblanklines %}

{% store /usr/sara/etc/cfengine3/hosts.lisa as output %}
{% use HardwareUnit with 'cluster__name=Lisa' as lisa_hosts %}

{% epilogue %}
/usr/bin/scp /usr/sara/etc/cfengine3/hosts.lisa cfengine3:/data/cfengine3/cf-runagent
{% endepilogue %}


body runagent control
{
        any::
                # Hack else we can not use it. Lisa cluster has the same keys for
                # compute nodes.
                #
                trustkey         	=> "true";
		max_children     	=> "40"; 
		background_children 	=> "true";

                output_to_file   	=> "true";
                output_directory 	=> "/var/log/cf-runagent/lisa";

                hosts => {
{% for hw in lisa_hosts %}
  {% for i in hw.interfaces.all %}
    {% if i.network.name == 'lisa admin' %}
      {% if not "inactive" in hw.roles and not "administration" in hw.roles and not "fileserver" in hw.roles %} 

                         "{{ i.fqdn }}",

      {% endif %}
    {% endif %}
  {% endfor %}
{% endfor %}
                };
}
{% endnoblanklines %}
